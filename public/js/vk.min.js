(function(){tuna.namespace("rest.vk");var a=function(){};tuna.implement(a,tuna.rest.IMethodFactory),a.prototype.createMethod=function(a){switch(a){case"social.friends.get":return new rest.vk.friends.GetList;case"social.wall.post":return new rest.vk.wall.Post}return null},rest.vk.VKMethodFactory=a})(),function(){tuna.namespace("rest.vk");var a=function(a){tuna.rest.RemoteMethod.call(this,a),this._handleResponse=tuna.bind(this._handleResponse,this)};tuna.extend(a,tuna.rest.RemoteMethod),a.prototype.call=function(a){VK.api(this._name,this._completeArguments(a),this._handleResponse)},a.prototype._completeArguments=function(a){return a},a.prototype._handleResponse=function(a){a.response!==undefined?this.dispatch("result",this._mapResponse(a.response)):this.dispatch("error",a)},a.prototype._mapResponse=function(a){return null},rest.vk.VKMethod=a}(),function(){tuna.namespace("rest.vk.friends");var a=function(){rest.vk.VKMethod.call(this,"friends.get")};tuna.extend(a,rest.vk.VKMethod),a.prototype._completeArguments=function(a){return{fields:"uid,first_name,last_name,photo"}},a.prototype._mapResponse=function(a){var b=[],c=null;for(var d in a)c=a[d],b.push({id:c.uid,name:c.first_name+" "+c.last_name,userpic:c.photo});return b},rest.vk.friends.GetList=a}(),function(){tuna.namespace("rest.vk.wall");var a=function(){rest.CommonMethod.call(this,"social.vk.uploadImage"),this.__userID=null,this.__imageData=null,this.__handleSavePhoto=tuna.bind(this.__handleSavePhoto,this),this.__handleWallPost=tuna.bind(this.__handleWallPost,this),this.__handleUploadURL=tuna.bind(this.__handleUploadURL,this)};tuna.extend(a,rest.CommonMethod),a.prototype.call=function(a){a!==undefined&&(this.__userID=a.user_id||null,this.__imageData=a.image_data||null);var b={};this.__userID!==null&&(b.uid=this.__userID),VK.api("photos.getWallUploadServer",b,this.__handleUploadURL)},a.prototype.__handleUploadURL=function(a){a.response!==undefined?(a.response.image=this.__imageData,rest.CommonMethod.prototype.call.call(this,a.response)):this.dispatch("error",a)},a.prototype._handleResponse=function(a){var b=null;try{b=JSON.parse(a)}catch(c){}b!==null&&b.response!==undefined?VK.api("photos.saveWallPhoto",b.response,this.__handleSavePhoto):this.dispatch("error",a)},a.prototype.__handleSavePhoto=function(a){if(a.response!==undefined&&a.response.length>0){var b=a.response[0],c=this.__userID;c===null&&(c=b.owner_id),VK.api("wall.post",{owner_id:c,message:"Смотри, какой у меня получился торт!",attachments:b.id},this.__handleWallPost)}else this.dispatch("error",a)},a.prototype.__handleWallPost=function(a){a.response!==undefined?this.dispatch("result",!0):this.dispatch("error",a)},rest.vk.wall.Post=a}();