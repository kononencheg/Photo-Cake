<!DOCTYPE HTML>
<html>
    <head>
        <title>Фотонаторте</title>

        <meta charset="utf-8" />

        <link href="http://stg.odnoklassniki.ru/share/odkl_share.css" media="screen" rel="stylesheet" type="text/css" />

        <link href="/css/reset.css"  media="screen" rel="stylesheet" type="text/css" />
        <link href="/css/style.css"  media="screen" rel="stylesheet" type="text/css" />
        <link href="/css/dummy.css"  media="screen" rel="stylesheet" type="text/css" />
        
    </head>
    <body>
        <div class="layout">
            <div class="header">
                <div class="logo">
                    <img alt="Фотонаторте" src="/img/logo.png" />
                </div>
            </div>

            <div class="body">
                <object id="cake_designer" width="660" height="600"
                        classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000">

                    <param name="movie" value="/swf/cake-designer-fake.swf" />
                    <param name="allowscriptaccess" value="always" />
                    <param name="wmode" value="opaque" />

                    <!--[if !IE]>-->
                    <object width="660" height="600" wmode="opaque"
                            data="/swf/cake-designer-fake.swf"
                            type="application/x-shockwave-flash"
                            allowscriptaccess="always">
                    <!--<![endif]-->

                        Для работы приложения вам необходим Flash Player!

                    <!--[if !IE]>-->
                    </object>
                    <!--<![endif]-->

                </object>
            </div>

            <div class="footer">
                <div class="share-block">
                    <div id="ok_share" class="share">
                        <a class="odkl-share-stat" href="http://178.250.241.76/"
                           onclick="ODKL.Share(this); return false;">
                            <span>0</span>
                        </a>
                    </div>

                    <div id="vk_share" class="share"></div>

                    <div id="fb_share" class="share">
                        <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%178.250.241.76%2F&amp;send=false&amp;layout=button_count&amp;width=150&amp;show_faces=true&amp;action=recommend&amp;colorscheme=light&amp;font&amp;height=50"
                                scrolling="no" frameborder="0" allowTransparency="true"
                                style="border:none; overflow:hidden; width:150px; height:34px;" ></iframe>
                    </div>
                </div>
            </div>


            <form id="image_form" target="frame_transport" action="/app/scripts/save-image.php" method="POST">
                <input id="image_hidden" type="hidden" name="image_data" />
            </form>

            <iframe name="frame_transport" src="about: blank" width="0" height="0"></iframe>

            <div id="popup" class="hidden">
                <div class="popup-overlay"></div>
                <div class="popup" onclick=" if((event.target || event.srcElement) === this) hide('popup')">
                    <div class="popup-content">

                        <div id="login_dialog" class="login-dialog">
                            <div>
                                Для того чтобы сохранить ваш тортик вам необходимо
                                авторизоваться на сайте, используя:
                            </div>

                            <div>
                                <a href="javascript: open('/app/scripts/auth-popup.php?auth_target=vk&js_callback=handleAuth', 'auth_popup', 'status=1, height=300, width = 600, resizable = 0');">
                                    <img src="img/vk-logo.png" alt="ВКонтакте" />
                                </a>

                                <a href="javascript: open('/app/scripts/auth-popup.php?auth_target=ok&js_callback=handleAuth', 'auth_popup', 'status=1, height=300, width = 600, resizable = 0');">
                                    <img src="img/ok-logo.png" alt="Одноклассники" />
                                </a>
                            </div>

                        </div>

                        <div id="cake_dialog" class="cake-dialog hidden">
                            <h2>Ваш тортик!</h2>
                            
                            <img id="cake_image" alt="Ваш тортик" src="" />
                        </div>

                    </div>
                    <div class="align-helper"></div>
                </div>
            </div>

        </div>

        <script src="http://vkontakte.ru/js/api/share.js?11" charset="windows-1251"></script>
        <script src="http://stg.odnoklassniki.ru/share/odkl_share.js"></script>
        <script src="/js/lib/swfobject.js" charset="utf-8"></script>

        <script>
            swfobject.registerObject('cake_designer', '9.0.0');

            var cakeDesigner = null;
            var isLoggedIn = false;

            function onFlashReady() {
                cakeDesigner = swfobject.getObjectById('cake_designer');
                cakeDesigner.initialize('round', 0.75);
            }

            function saveCakeData(junk, imageData) {
                $('image_hidden').value = imageData;
                if (isLoggedIn) {
                    $('image_form').submit();
                }

                show('popup');
            }


            function handleAuth(isSuccess) {
                isLoggedIn = isSuccess;
                if (isLoggedIn) {
                    $('image_form').submit();
                }
            }

            function handleImage(src) {
                $('cake_image').src = src;

                hide('login_dialog');
                show('cake_dialog');
            }


            function $(id) {
                return document.getElementById(id);
            }

            function show(id) {
                $(id).style.display = 'block';
            }

            function hide(id) {
                $(id).style.display = 'none';
            }

            function initShareButtons() {
                ODKL.init();

                $('vk_share').innerHTML = VK.Share.button({
                    url: 'http://178.250.241.76/',
                    title: 'Фотонаторте',
                    description: 'Конструктор торта!',
                    image: 'http://178.250.241.76/img/logo.png',
                    noparse: true
                }, {
                    type: 'button',
                    text: 'Поделиться'
                });
            }

            initShareButtons();


        </script>
    </body>
</html>