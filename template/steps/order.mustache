<form class="j-template-transformer j-form form-horizontal"
      action="/api/" method="POST" target="support_frame"
      data-name="order-form"
      data-template-id="order_template">

    <div class="row-fluid">
        <div class="span7">
            <div class="j-form-message alert alert-error hide"></div>

            <input type="hidden" name="method" value="orders.add" />
            <input type="hidden" name="format" value="frame-callback" />

            <input class="t-recipe-id" type="hidden" name="recipe_id" />
            <input class="t-bakery-id" type="hidden" name="bakery_id" />
            <input class="t-cake-id"   type="hidden" name="cake_id" />

            <input name="payment_method" type="hidden" value="0" />
            <input name="client_network" type="hidden" />

            <fieldset>
                <legend>Рецепт</legend>

                <div class="j-recipe_id-input control-group">
                    <label class="control-label">Название</label>
                    <div class="controls">
                        <div class="input-append">
                            <span class="t-recipe-name
                                         uneditable-input input-medium">
                                Тирамису
                            </span>
                            <span class="add-on">
                                <a class="j-popup-button"
                                   data-name="recipe-popup"
                                   data-popup-id="recipe_popup">Другой...</a>
                            </span>
                        </div>
                        <p class="j-message help-block">Рецепт торта</p>
                    </div>
                </div>

            </fieldset>

            <fieldset>
                <legend>Личные данные</legend>

                <div class="j-client_name-input control-group">
                    <label class="control-label">Имя *</label>
                    <div class="controls">
                        <div class="input">
                            <input name="client_name" type="text" />
                        </div>
                        <p class="j-message help-block">Ваше настоящее имя.</p>
                    </div>
                </div>

                <div class="j-client_phone-input control-group">
                    <label class="control-label">Телефон *</label>
                    <div class="controls">
                        <div class="input">
                            <input name="client_phone" type="text" />
                        </div>
                        <p class="j-message help-block">Чтобы мы могли с вами связаться</p>
                    </div>
                </div>

                <div class="j-client_email-input control-group">
                    <label class="control-label">
                        Email {{^ok_network}}*{{/ok_network}}
                    </label>
                    <div class="controls">
                        <div class="input">
                            <input name="client_email" type="text" />
                        </div>
                        <p class="j-message help-block">Для подтверждения заказа</p>
                    </div>
                </div>

            </fieldset>

            <fieldset>
                <legend>Информация о доставке</legend>

                <div class="j-delivery_address-input control-group">
                    <label class="control-label">Адрес *</label>
                    <div class="controls">
                        <div class="input">
                            <textarea name="delivery_address" rows="2"></textarea>
                        </div>
                        <p class="j-message help-block">Куда нужно везти торт.</p>
                    </div>
                </div>

                <div class="j-delivery_date-input j-delivery_time-input control-group">
                    <label class="control-label">Дата *</label>
                    <div class="controls">
                        <div class="input">
                            <input name="delivery_date" type="text"
                                   class="j-datepicker input-mini input-small-rest" />

                            <select name="delivery_time" class="small-rest">
                                <option value="-1">и время</option>
                                <option value="36000">10:00-12:00</option>
                                <option value="43200">12:00-14:00</option>
                                <option value="50400">14:00-16:00</option>
                                <option value="57600">16:00-18:00</option>
                                <option value="64800">18:00-20:00</option>
                                <option value="72000">20:00-22:00</option>
                            </select>

                            <p class="j-message help-block">Когда нужно везти торт.</p>
                        </div>
                    </div>
                </div>

                <div class="j-delivery_comment-input control-group">
                    <label class="control-label">Комментарий</label>
                    <div class="controls">
                        <div class="input">
                            <textarea name="delivery_comment" rows="2"></textarea>
                            <p class="j-message help-block">Если вы что-то хотите добавить.</p>
                        </div>
                    </div>
                </div>

                <div class="j-delivery_message-input control-group">
                    <label class="control-label">Текст открытки</label>
                    <div class="controls">
                        <div class="input">
                            <textarea name="delivery_message" rows="2"></textarea>
                            <p class="j-message help-block">Записка к торту, если, например, торт в подарок.</p>
                        </div>
                    </div>
                </div>

            </fieldset>
        </div>

        <div class="span5 cake-info">
            <fieldset>
                <legend>Торт</legend>

                <div class="cake-image">
                    <img class="j-data-image-copy" alt="Загрузка тортика..."
                         src data-image-selector="#base_cake_image" />
                </div>

                <div class="j-template-transformer cake-price"
                     data-name="price-info"
                     data-template-id="price_template">

                    <h3>Цена</h3>

                    <table class="table table-condensed">
                        <tr>
                            <th>Оформление: </th>
                            <td>
                                <span class="t-decoration-price">0</span> рублей
                            </td>
                        </tr>
                        <tr>
                            <th>Рецепт: </th>
                            <td>
                                <span class="t-recipe-price">0</span> рублей
                            </td>
                        </tr>
                        <tr>
                            <th>Доставка: </th>
                            <td>
                                <span class="t-delivery-price">0</span> рублей
                            </td>
                        </tr>
                        <tr>
                            <th>Итого: </th>
                            <td>
                                <span class="t-total-price">0</span> рублей
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="order-navigation">

                    <a class="j-navigation-link btn primary large"
                       data-action="back">
                        &laquo; Назад
                    </a>

                    <input type="submit" value="Заказать!"
                           class="btn primary large pull-right" />
                </div>

            </fieldset>
        </div>
    </div>
</form>

{{> template/steps/order/recipe-popup }}

<div class="j-control-container hide">

    <tuna:template id="order_template">

        <tuna:attr tuna:name="value" tuna:target="t-recipe-id"
                   tuna:path="recipe/id" />

        <tuna:attr tuna:name="value" tuna:target="t-bakery-id"
                   tuna:path="bakery/id" />

        <tuna:attr tuna:name="value" tuna:target="t-cake-id"
                   tuna:path="cake/id" />

        <tuna:spot tuna:target="t-recipe-name"
                   tuna:path="recipe/name" />

        <tuna:spot tuna:target="t-recipe-price"
                   tuna:path="recipePrice" />

        <tuna:spot tuna:target="t-delivery-price"
                   tuna:path="deliveryPrice" />

        <tuna:spot tuna:target="t-decoration-price"
                   tuna:path="decorationPrice" />

        <tuna:spot tuna:target="t-total-price"
                   tuna:path="totalPrice" />

    </tuna:template>

</div>